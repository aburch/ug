#!/bin/sh
if test "$1" = "-help"
then
	echo "usage: $0 [<ugmodule>] [makeoptions]";
	echo "purpose: compile by calling \"make\" with the right Makefile[.<ugmodule>]";
	echo "Options are";
	echo " <ugmodule>: the module which you want to compile";
	echo "             where <ugmodule> is one of ug, dev, meta, xif";
	echo "             gm, graph, low, numerics, ui, gg, dom, std";
	echo "             diff2d, diff2da,cd, cda, fem, fema, ns2d, ns2da";
	echo " <makeoptions>: the options which you want to pass to \"make\"";
	exit 1;
fi

if test "x$UGROOT" = "x"
then
	echo "$0: to use $0 set shell environment variable UGROOT!";
	exit 1;
fi

# if no parameter is specified make in current directory
if test $# -eq 0 
then
	if test `ls Makefile*|wc -l` -eq 1 
	then
		make -f `ls Makefile*`;
		exit 0;
	else
		echo "$0: Makefile not found or not unique!"; 
		exit 1;
	fi
fi

# if parameter are specified make the specified module
if test $# -ge 1 
then
	# check whether first  option is ug module 
	if test "$1" = "ug" -o "$1" = "dev" -o "$1" = "meta" -o "$1" = "xif" -o "$1" = "gm" -o "$1" = "graph" -o "$1" = "low" -o "$1" = "numerics" -o "$1" = "ui" -o "$1" = "gg" -o "$1" = "dom" -o "$1" = "std"
	then
		if test "$1" = "ug"
		then 
			cd $UGROOT;
		else
			if test "$1" = "meta" -o "$1" = "xif"
			then
				cd $UGROOT/dev/$1;
			else
				if test "$1" = "std"	
				then
					cd $UGROOT/dom/std;
				else
					cd $UGROOT/$1;
				fi
			fi
		fi
		shift;
	fi

	# check whether first option is problem class or application
	if test "$1" = "diff2d" -o "$1" = "diff2da" 
	then
		if test -d $UGROOT/../diff2d
		then
			cd $UGROOT/../diff2d;
		else 
			echo "no directory for diff2d found!";
			exit 1;
		fi				
	fi			
			
	if test "$1" = "cd" -o "$1" = "cda" 
	then
		if test -d $UGROOT/../cd
		then
			cd $UGROOT/../cd;
		else 
			echo "no directory for cd found!";
			exit 1;
		fi				
	fi			
			
	if test "$1" = "fem" -o "$1" = "fema" 
	then
		if test -d $UGROOT/../fem
		then
			cd $UGROOT/../fem;
		else 
			echo "no directory for fem found!";
			exit 1;
		fi				
	fi			
			
	if test "$1" = "ns2d" -o "$1" = "ns2da" 
	then
		if test -d $UGROOT/../ns2d
		then
			cd $UGROOT/../ns2d;
		else 
			echo "no directory for ns2d found!";
			exit 1;
		fi				
	fi			
			
	if test "$1" = "diff2d" -o "$1" = "cd" -o "$1" = "fem" -o "$1" = "ns2d"
	then
		cd pclib;
		shift;
	fi

	if test "$1" = "diff2da" -o "$1" = "cda" -o "$1" = "fema" -o "$1" = "ns2da"
	then
		cd appl;
		shift;
	fi

	# call make with the right makefile
	if test `ls Makefile*|wc -l` -eq 1 
	then
		make -f `ls Makefile*` $*;
		exit $?;
	else
		echo "$0: Makefile not found or not unique!"; 
		exit 1;
	fi
fi

exit 0;
