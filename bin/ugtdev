#!/bin/csh -f
if ( $1 == "-H" ) then
echo "ugtdev [-a | -m | -g | -h] [-G] <film-name>"; exit;
endif

set timescale = 1;

if ( $1 == "-a" ) then
set timescale = 31536000; shift;
endif

if ( $1 == "-m" ) then
set timescale = 2592000; shift;
endif

if ( $1 == "-g" ) then
set timescale = 86400; shift;
endif

if ( $1 == "-h" ) then
set timescale = 3600; shift;
endif

set Screen = 0;
if ( $1 == "-G" ) then
set Screen = 1; shift;
endif

rm -f t.li;
rm -f dt.li;
set PREFIX = $1
@ i = 0
while ( $i <= 10000 )
	set nr = `echo $i | awk '{printf("%04d.ug.data.bin",$1);}' - `
	if (! -f $PREFIX.$nr ) break;
	echo "extracting data from file" $PREFIX.$nr
	ugmgs $PREFIX.$nr | awk '$1=="Time:"     {print awk_i,$2/(ts+0);i++;}' ts=$timescale awk_i=$i  - >> t.li
	ugmgs $PREFIX.$nr | awk '$1=="TimeStep:" {print awk_i,$2/(ts+0);i++;}' ts=$timescale awk_i=$i  - >> dt.li
	@ i = $i + 1
end

if ( $Screen == 1 ) then 
	echo 'set parametric; set grid; plot "t.li" w l; pause -1; set terminal postscript; set output "t.ps"; plot "t.li" w l;' > t.gnu;
endif
if ( $Screen == 0 ) then 
	echo 'set parametric; set grid; set terminal postscript; set output "t.ps"; plot "t.li" w l;' > t.gnu;
endif
gnuplot "t.gnu";
if ( $Screen == 1 ) then 
	echo 'set parametric; set grid; plot "dt.li" w l; pause -1; set terminal postscript; set output "dt.ps"; plot "dt.li" w l;' > dt.gnu;
endif
if ( $Screen == 0 ) then
	echo 'set parametric; set grid; set terminal postscript; set output "dt.ps"; plot "dt.li" w l;' > dt.gnu;
endif
gnuplot "dt.gnu";
rm t.li;
rm dt.li;
rm t.gnu;
rm dt.gnu;
