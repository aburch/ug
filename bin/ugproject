#!/bin/sh
# ugproject
if test "$1" = "-help"
then
	echo "usage: $0 [options]";
	echo "purpose: compile all ug libraries and applications";
	echo "Options are";
	echo " ug2, ug3, appl2, appl3 "
	exit 1;
fi

if test "x$UGROOT" = "x"
then
	echo "$0: to use $0 set shell environment variable UGROOT!";
	exit 1;
fi

# set -e to stop after the first error; otherwise you may miss errors.
set -e

ug2 () 
{
	ugconf 2
	ugmake ug uglib
	ugmake dom
}

ug3 () 
{
	ugconf 3
	ugmake ug uglib
	ugmake dom
}

appl2 () 
{
    if test -d $UGROOT/../simple
	then
		ugmake simple
	fi
    if test -d $UGROOT/../diff2d
	then
		ugmake diff2da
	fi
    if test -d $UGROOT/../cd
	then
		ugmake cda
	fi
    if test -d $UGROOT/../fem
	then
		ugmake fema
	fi
    if test -d $UGROOT/../ns2d
	then
		ugmake ns2da
	fi
    if test -d $UGROOT/../scalar
	then
		ugmake scalar2d
	fi
}

appl3 () 
{
    if test -d $UGROOT/../cd
	then
		ugmake cda 
	fi
    if test -d $UGROOT/../fem
	then
		ugmake fema
	fi
    if test -d $UGROOT/../scalar
	then
		ugmake scalar3d
	fi
}

if test "$1" = "ug2"
then
	ug2;
	exit 1;
fi

if test "$1" = "ug3"
then
	ug3;
	exit 1;
fi

if test "$1" = "appl2"
then
	appl2;
	exit 1;
fi

if test "$1" = "appl3"
then
	appl3;
	exit 1;
fi

# default

# save ug.conf
cp $UGROOT/ug.conf $UGROOT/ug.conf.tmp

ugclean all
ugconf 2
ugconf NONETGEN
( ug2 );
ugmake dev
( appl2 );

ugconf 3
if test "$1" = "netgen"
then
    ugconf NETGEN
fi

# clean 2d opjects

ugmake ug -i ifdef
if test -d $UGROOT/../cd
then
	ugmake cda -i ifdef
fi
if test -d $UGROOT/../fem
then
	ugmake fem -i ifdef
fi
if test -d $UGROOT/../scalar
then
	ugmake scalar -i clean
fi

( ug3 );
( appl3 );

# restore ug.conf
mv $UGROOT/ug.conf.tmp $UGROOT/ug.conf

ugmake ug -i ifdef

echo "simple, diff2da, ns2da, cd2d, cd3d, fem2d, fem3d, scalar2d, scalar3d created"
