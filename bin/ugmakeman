#!/bin/sh

if test $# -ge 2 -o \( $# -eq 1 -a ! \( "$1" = "-remove" -o "$1" = "-new" \) \)
then
    echo "usage: $0 [-remove | -new]";
    echo "purpose: generate man pages for ug";
    echo "Options are";
    echo " -remove: remove the old man pages";
    echo " -new: remove old and generate new man pages";
    exit 1;
fi

if test "x$UGROOT" = "x"
then
	echo "$0: to use $0 set shell environment variable UGROOT!";
	exit 1;
fi

if test "$1" = "-remove" -o "$1" = "-new"
then
	for i in $UGROOT/man/*/* 
	do
    	rm $i
	done
	if test -d $UGROOT/../cd3d/man
	then
		rm $UGROOT/../cd3d/man/*/*
	fi
	if test -d $UGROOT/../diff2d/man
	then
		rm $UGROOT/../diff2d/man/*/*
	fi
	if test -d $UGROOT/../fem/man
	then
		rm $UGROOT/../fem/man/*/*
	fi
    echo "$0: old man pages removed!"
fi


#if no parameter is specified make the specified module
if test $# -eq 0 -o "$1" = "-new"
then
	# generate ug man pages
	cd $UGROOT;
	doctext -mpath $UGROOT/man/man3 -ext 3 -heading ug -quotefmt *.doc

	# generate dev man pages
	cd $UGROOT/dev;
	doctext -mpath $UGROOT/man/man4 -ext 4 -heading ug/dev -quotefmt *.c *.h
	doctext -mpath $UGROOT/man/man3 -ext 3 -heading ug/dev -quotefmt *.doc

	# generate gm man pages
	cd $UGROOT/gm;
	doctext -mpath $UGROOT/man/man5 -ext 5 -heading ug/gm -quotefmt *.c *.h
	doctext -mpath $UGROOT/man/man3 -ext 3 -heading ug/gm -quotefmt *.doc

	# generate graph man pages
	cd $UGROOT/graph;
	doctext -mpath $UGROOT/man/man6 -ext 6 -heading ug/graph -quotefmt *.c *.h
	doctext -mpath $UGROOT/man/man3 -ext 3 -heading ug/graph -quotefmt *.doc

	# generate low man pages
	cd $UGROOT/low;
	doctext -mpath $UGROOT/man/man7 -ext 7 -heading ug/low -quotefmt *.c *.h
	doctext -mpath $UGROOT/man/man3 -ext 3 -heading ug/low -quotefmt *.doc

	# generate numerics man pages
	cd $UGROOT/numerics;
	for i in *.c *.h
	do 
		if test "$i" = "basics.c" -o "$i" = "mgsolver.c" -o "$i" = "nlsolver.c" -o "$i" = "smoother.c"
		then
			doctext -ext 1 -heading ug/numerics -quotefmt $i
			mv [a-z][a-z].1 $UGROOT/man/man1; 
			mv [a-z][a-z][a-z]*.1 $UGROOT/man/man1; 
			for j in *.1
			do 
				mv $j $UGROOT/man/man8/`echo $j|sed 's/\.1/\.8/'`;
			done
		else
			doctext -mpath $UGROOT/man/man8 -ext 8 -heading ug/numerics -quotefmt $i
		fi
	done
	doctext -mpath $UGROOT/man/man3 -ext 3 -heading ug/numerics -quotefmt *.doc

	# generate ui man pages
	cd $UGROOT/ui;
	for i in *.c *.h
	do
		if test "$i" = "commands.c"
		then
	  		doctext -ext 1 -heading ug/ui -quotefmt $i
			mv [a-z]*.1 $UGROOT/man/man1;
			for j in *.1
			do 
				mv $j $UGROOT/man/man8/`echo $j|sed 's/\.1/\.8/'`;
			done
		else
	  		doctext -mpath $UGROOT/man/man9 -ext 9 -heading ug/ui -quotefmt $i
		fi
	done
	doctext -mpath $UGROOT/man/man3 -ext 3 -heading ug/ui -quotefmt *.doc

	#generate administration man pages
	if test -d $UGROOT/..
	then
		cd $UGROOT/..
		doctext -mpath $UGROOT/man/man2 -ext 2 -heading admin -quotefmt *.doc
	fi
	cd $UGROOT/bin
	doctext -mpath $UGROOT/man/man2 -ext 2 -heading admin -quotefmt *.doc
	cd $UGROOT/doc
	doctext -mpath $UGROOT/man/man2 -ext 2 -heading admin -quotefmt *.doc

	#generate man pages for diff2d
	cd $UGROOT/../diff2d
	doctext -mpath $UGROOT/../diff2d/man/mana -ext a -heading diff2d -quotefmt *.doc
	cd $UGROOT/../diff2d/pclib
	doctext -mpath $UGROOT/../diff2d/man/manb -ext b -heading diff2d/pclib -quotefmt *.c *.h
	cd $UGROOT/../diff2d/appl
	doctext -mpath $UGROOT/../diff2d/man/manc -ext c -heading diff2d/appl -quotefmt *.c *.h

	#generate man pages for cd3d
	cd $UGROOT/../cd3d
	doctext -mpath $UGROOT/../cd3d/man/mana -ext a -heading cd3d -quotefmt *.doc
	cd $UGROOT/../cd3d/pclib
	doctext -mpath $UGROOT/../cd3d/man/mand -ext d -heading cd3d/pclib -quotefmt *.c *.h
	cd $UGROOT/../cd3d/appl
	doctext -mpath $UGROOT/../cd3d/man/mane -ext e -heading cd3d/appl -quotefmt *.c *.h

	#generate man pages for fem
	cd $UGROOT/../fem
	doctext -mpath $UGROOT/../fem/man/mana -ext a -heading fem -quotefmt *.doc
	cd $UGROOT/../fem/pclib
	doctext -mpath $UGROOT/../fem/man/manf -ext f -heading fem/pclib -quotefmt *.c *.h
	cd $UGROOT/../fem/appl
	doctext -mpath $UGROOT/../fem/man/mang -ext g -heading fem/appl -quotefmt *.c *.h

	echo "$0: man pages for ug created!";
	exit 0;
fi

